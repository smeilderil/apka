<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mines Signals — Demo</title>
<style>
  :root{
    --bg:#0b1220;
    --panel:#0d162a;
    --accent:#2563ff;
    --text:#e8f0ff;
    --muted:#9db0d3;
    --shadow:0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05);
  }
  *{box-sizing:border-box}
  html,body{
    height:100%;
    margin:0;
    overflow:hidden;
  }
  body{
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    color:var(--text);
    background: radial-gradient(1200px 600px at 70% -10%, #1a2340 0%, #0a0f1d 50%, #070b15 100%), var(--bg);
    display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .app{
    width: min(420px, 96vw);
    max-height: 96vh;
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)) , var(--panel);
    border-radius: 16px;
    box-shadow: var(--shadow);
    padding: 14px 16px 18px;
    position:relative;
    overflow:hidden;
  }
  .brand{
    display:flex; align-items:center; justify-content:center;
    margin:2px 2px 8px;
  }
 .brand img{
    height:64px; /* увеличено с 32px */
    max-width:100%;
    display:block;
}
  h1{
    margin:2px 0 4px;
    font-size:clamp(20px,4.5vw,30px);
    letter-spacing:.5px;
  }
  .meta{
    color:var(--muted);
    font-size:12px;
    margin-bottom:10px;
    text-align:center;
  }
  .board{
    background:#0c1426;
    border-radius:14px;
    box-shadow:var(--shadow);
    padding:10px;
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:8px;
    margin:4px 0 12px;
  }
  .cell{
    aspect-ratio:1/1;
    background:url("qw1.png") center/cover no-repeat;
    border-radius:8px;
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.06),0 6px 16px rgba(0,0,0,.35);
    display:flex;
    align-items:center;
    justify-content:center;
    transition:transform .08s ease,box-shadow .2s ease;
    position:relative;
    overflow:hidden;
    cursor:pointer;
    border:none;
    outline:none;
  }
  .cell:focus{outline:none;}
  .cell:hover:not(.disabled){transform:translateY(-2px);}
  .cell.disabled{cursor:not-allowed;opacity:0.7;}
  .cell .star{
    position:absolute;
    inset:0;
    opacity:0;
    transform:scale(0.7) rotate(-15deg);
    transition:opacity 1.2s cubic-bezier(0.34,1.56,0.64,1),transform 1.2s cubic-bezier(0.34,1.56,0.64,1);
    filter:drop-shadow(0 0 12px rgba(37,99,255,0.6));
  }
  .cell.signal .star{
    opacity:1;
    transform:scale(1) rotate(0deg);
  }
  .cell .star img{
    width:100%;
    height:100%;
    object-fit:cover;
  }
  .controls{
    display:flex;
    align-items:center;
    gap:8px;
    justify-content:center;
    margin:2px 0 6px;
  }
  .btn{
    background:linear-gradient(180deg,#3b6cff,#1f4cff);
    color:white;
    font-weight:800;
    letter-spacing:.4px;
    padding:12px 16px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    box-shadow:0 8px 26px rgba(37,99,255,.5),inset 0 0 0 1px rgba(255,255,255,.08);
    text-transform:uppercase;
    transition:all 0.3s ease;
    font-size:13px;
    min-width: 160px;
  }
  .btn:active:not(:disabled){transform:translateY(1px);}
  .btn:disabled{
    background:linear-gradient(180deg,#2a4cc0,#1a3a9c);
    cursor:not-allowed;
    opacity:0.7;
  }
  .round{
    width:34px;
    height:34px;
    border-radius:50%;
    background:#0f1930;
    border:1px solid rgba(255,255,255,.06);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    color:#9db0d3;
    cursor:pointer;
  }
  .round:disabled{
    cursor:not-allowed;
    opacity:0.5;
  }
  .footer{
    margin-top:6px;
    color:var(--muted);
    font-size:11px;
    text-align:center;
  }
  .kpi{
    display:flex;
    justify-content:space-between;
    gap:6px;
    font-size:12px;
    margin:6px 2px 4px;
    color:var(--muted);
    flex-wrap:wrap;
  }
  .pill{
    padding:4px 7px;
    border:1px solid rgba(255,255,255,.06);
    border-radius:999px;
    background:#0f1930;
    color:#cfe0ff;
    font-size:11px;
  }
  .warn{
    font-size:10px;
    opacity:.85;
    margin-top:3px;
    line-height:1.3;
  }
  .flag{
    width:24px;
    height:14px;
    border-radius:3px;
    background:linear-gradient(#fff 0 33%,#0038a8 33% 66%,#d52b1e 66%);
    box-shadow:inset 0 0 0 1px rgba(0,0,0,.15);
    margin-left:auto;
  }
  .header-line{
    display:flex;
    align-items:center;
    gap:6px;
    margin-bottom:2px;
    justify-content: center;
  }
  .timer-progress{
    height:4px;
    background:#0f1930;
    border-radius:3px;
    margin-top:6px;
    overflow:hidden;
  }
  .timer-progress-inner{
    height:100%;
    background:linear-gradient(90deg,#3b6cff,#1f4cff);
    border-radius:3px;
    transition:width 0.25s linear;
    width: 100%;
  }
  
  /* Стили для ограничения выбора бомб */
  .bomb-selector {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin: 6px 0 10px;
  }
  .bomb-option {
    padding: 5px 10px;
    background: #0f1930;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 18px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 12px;
  }
  .bomb-option.active {
    background: linear-gradient(180deg,#3b6cff,#1f4cff);
    color: white;
    border-color: rgba(255,255,255,0.2);
    box-shadow: 0 4px 12px rgba(37,99,255,.3);
  }
</style>
</head>
<body>


  <div class="app">
    <div class="brand" style="position: relative; display: flex; align-items: center; justify-content: center; gap: 8px;">
  <img src="logo1win.png" alt="1win logo">
  <button class="btn-back" onclick="window.location.href='../index.html'" 
          style="padding:6px 12px; font-size:13px; border-radius:12px; border:none;
                 background: linear-gradient(180deg,#3b6cff,#1f4cff); color:white; cursor:pointer;">
    Назад
  </button>
</div>




    <div class="header-line">
      <h1 id="bombTitle">3 БОМБЫ</h1>
      
      <div class="flag" title="RU"></div>
    </div>

    <div class="meta">Точность сигнала: <span id="acc">95%</span></div>
    
    <!-- Селектор для выбора количества бомб -->
    <div class="bomb-selector">
      <div class="bomb-option active" data-bombs="1">1 БОМБА</div>
      <div class="bomb-option" data-bombs="3">3 БОМБЫ</div>
      <div class="bomb-option" data-bombs="5">5 БОМБ</div>
      <div class="bomb-option" data-bombs="7">7 БОМБ</div>
    </div>

    <div class="board" id="board" aria-label="Игровое поле 5x5"></div>

    <div class="kpi">
      <div class="pill">Сетка: 5×5</div>
      <div class="pill">Бомб: <span id="bombsLabel">3</span></div>
      <div class="pill">Сигналы: <span id="signalsLabel">5</span></div>
      <div class="pill">Таймер: <span id="timer">15с</span></div>
    </div>

    <div class="controls">
      <button class="btn" id="signalBtn">ПОЛУЧИТЬ СИГНАЛ</button>
    </div>

    <div class="timer-progress">
      <div class="timer-progress-inner" id="timerProgress"></div>
    </div>

    <div class="footer">
      
    </div>
  </div>

  <!-- шаблон сигнальной картинки -->
  <template id="starTpl">
    <div class="star" aria-hidden="true">
      <img src="qw2.png" alt="signal">
    </div>
  </template>

<script>

const board=document.getElementById("board");
const bombsLabel=document.getElementById("bombsLabel");
const bombTitle=document.getElementById("bombTitle");
const signalsLabel=document.getElementById("signalsLabel");
const acc=document.getElementById("acc");
const timerSpan=document.getElementById("timer");
const timerProgress=document.getElementById("timerProgress");
const starTpl=document.getElementById("starTpl").content;

let bombs=3;
let signals=5;
let timer=15;
let interval;

function renderBoard(){
  board.innerHTML="";
  for(let i=0;i<25;i++){
    const cell=document.createElement("div");
    cell.className="cell";
    const inner=document.createElement("div");
    inner.className="cell-inner";
    cell.appendChild(inner);
    board.appendChild(cell);
  }
}
renderBoard();

function updateUI(){
  bombsLabel.textContent=bombs;
  
  // Правильное склонение слова "БОМБА"
  let bombWord;
  if (bombs === 1) bombWord = "БОМБА";
  else if (bombs >= 2 && bombs <= 4) bombWord = "БОМБЫ";
  else bombWord = "БОМБ";
  
  bombTitle.textContent = bombs + " " + bombWord;
  signalsLabel.textContent=signals;
  
  // Обновляем активную опцию в селекторе бомб
  document.querySelectorAll('.bomb-option').forEach((option, index) => {
    const optionBombs = parseInt(option.getAttribute('data-bombs'));
    if (optionBombs === bombs) {
      option.classList.add('active');
    } else {
      option.classList.remove('active');
    }
  });
}
updateUI();

// Обработчики для селектора бомб
document.querySelectorAll('.bomb-option').forEach((option) => {
  option.addEventListener('click', () => {
    bombs = parseInt(option.getAttribute('data-bombs'));
    updateUI();
  });
});

function getWeightedRandom(max) {
  let weights = [];
  for (let i = 1; i <= max; i++) {
    weights.push(max - i + 1); // маленький шанс для больших чисел
  }
  let totalWeight = weights.reduce((a,b)=>a+b,0);
  let rnd = Math.random() * totalWeight;
  for (let i = 0; i < weights.length; i++) {
    if (rnd < weights[i]) return i+1;
    rnd -= weights[i];
  }
  return max;
}

function getSignal(){
  renderBoard();
  const cells = board.querySelectorAll(".cell");
  let safeIndexes=[...Array(25).keys()];
  
  let signalAmount = getWeightedRandom(7); // от 1 до 7 с маленьким шансом для 7

  for(let i=0; i<signalAmount; i++){
    if(safeIndexes.length === 0) break;
    let idx = Math.floor(Math.random()*safeIndexes.length);
    let cellIndex = safeIndexes.splice(idx,1)[0];
    cells[cellIndex].classList.add("safe");
    cells[cellIndex].appendChild(starTpl.cloneNode(true));
    setTimeout(()=>{
      cells[cellIndex].classList.add("signal");
    }, 50*i);
  }

  acc.textContent=(90+Math.floor(Math.random()*10))+"%";
  signals--;
  updateUI();
  startTimer();
}

document.getElementById("signalBtn").onclick=()=>{if(signals>0)getSignal();};

function startTimer(){
  clearInterval(interval);
  timer = 15;
  timerSpan.textContent = timer + "с";
  timerProgress.style.transition = "width 1s linear"; // плавный переход
  timerProgress.style.width = "100%";
  
  document.getElementById("signalBtn").disabled = true; // блокируем кнопку

  interval = setInterval(() => {
    timer--;
    timerSpan.textContent = timer + "с";
    timerProgress.style.width = (timer/15*100) + "%";

    if(timer <= 0){
      clearInterval(interval);
      document.getElementById("signalBtn").disabled = false; // разблокируем кнопку
    }
  }, 1000);
}

</script>
</body>
</html>